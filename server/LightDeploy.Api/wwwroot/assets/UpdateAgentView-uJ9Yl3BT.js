import{T as B}from"./TabPage-fig3sxZb.js";import{d as T,r as n,o as d,a7 as m,az as C,l as U,O as p,P,X as r,W as y,R as s,S,U as g,_ as z,F,a6 as N,aA as R,Z as V}from"./index-IJZQufTE.js";import{_ as q}from"./Input-0LXRZhOI.js";import{a as A}from"./DataTable-NQz5RrxM.js";import{_ as K}from"./Scrollbar-3iNRaGkx.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./use-merged-state-YxQ28VZH.js";import"./Icon-9eBcRM8V.js";import"./Dropdown-EnJ99DEV.js";import"./Follower-BiAojMZj.js";import"./FocusDetector-ucGJCokY.js";const D={class:"flex gap-2 flex-items-center justify-center"},E=y("div",{style:{color:"lightgray"}}," 注意：更新操作会将安装包上传到服务器并解压，然后重启服务,在控制台输出操作完成后会花费一定的时间(不超过2分钟)重启Agent服务， 期间不要进行任何发布更新操作，如果长时间未完成需要自行检查原因 ",-1),Q=T({__name:"UpdateAgentView",setup(I){const u=n([]),h=[{type:"selection"},{title:"编号",key:"id"},{title:"IP",key:"host"},{title:"端口",key:"port"},{title:"健康检查地址",key:"healthCheckUrl"},{title:"权限认证",key:"authKey"}],o=n([]),i=n("");d(()=>{m.request({url:"/target/query",method:"get"}).then(l=>{u.value=l,o.value=l.map(e=>e.id)})});function f(){console.log(o.value),m.request({url:"/deploy/update-agent",method:"post",params:{targetIds:o.value,zipFilePath:i.value}}).then(()=>{window.$message.success("操作成功")})}const c=n([]);let a=null;const _=n(null);return d(()=>{a=new EventSource("/api/sse"),a.onmessage=l=>{c.value.push(l.data),C(()=>{var e;(e=_.value)==null||e.scrollBy(0,200)})}}),U(()=>{a==null||a.close()}),(l,e)=>{const k=q,v=N,x=A,w=K,b=R;return p(),P(B,null,{default:r(()=>[y("div",D,[s(k,{placeholder:"安装包完整路径",style:{"max-width":"500px"},value:i.value,"onUpdate:value":e[0]||(e[0]=t=>i.value=t)},null,8,["value"]),s(v,{onClick:f},{default:r(()=>[S("开始更新")]),_:1}),E]),s(x,{data:u.value,columns:h,"row-key":t=>t.id,style:{height:"400px","margin-top":"20px"},"flex-height":"",size:"small","checked-row-keys":o.value,"onUpdate:checkedRowKeys":e[1]||(e[1]=t=>o.value=t)},null,8,["data","row-key","checked-row-keys"]),s(b,{title:"控制台",style:{"margin-top":"20px"}},{default:r(()=>[s(w,{style:{"max-height":"300px"},trigger:"none",class:"log-box-scrollbar",ref_key:"logScrollBar",ref:_},{default:r(()=>[(p(!0),g(F,null,z(c.value,t=>(p(),g("div",null,V(t),1))),256))]),_:1},512)]),_:1})]),_:1})}}});export{Q as default};
